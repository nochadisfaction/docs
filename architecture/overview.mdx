---
title: "System Architecture Overview"
description: "A comprehensive look at Pixelated Empathy's microservices architecture — how eight core components work together to deliver AI-powered mental health training at scale."
---

## Architecture at a glance

Pixelated Empathy is built as a **distributed microservices architecture** designed for security, scalability, and real-time therapeutic simulation. Every component is independently deployable, horizontally scalable, and communicates through well-defined API contracts.

<Note>
  This architecture is designed to meet **HIPAA compliance requirements** at every layer — from client-side audio processing (zero-knowledge) to PII-filtered memory storage and encrypted data transit.
</Note>

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          CLIENT LAYER                                   │
│  ┌─────────────────────┐  ┌──────────────────┐  ┌──────────────────┐   │
│  │   Astro 5 + React   │  │  Training Platform│  │  Supervisor      │   │
│  │   Frontend (SSR)    │  │  (Three.js/WebGL) │  │  Dashboard       │   │
│  └────────┬────────────┘  └────────┬─────────┘  └────────┬─────────┘   │
│           │                        │                      │             │
│           └────────────┬───────────┴──────────────────────┘             │
│                        │  HTTPS / WebSocket                             │
└────────────────────────┼────────────────────────────────────────────────┘
                         │
┌────────────────────────┼────────────────────────────────────────────────┐
│                   API GATEWAY LAYER                                      │
│  ┌─────────────────────┴──────────────────────────────────────────────┐ │
│  │              Node.js + Express API Gateway                         │ │
│  │    ┌──────────┐ ┌──────────┐ ┌───────────┐ ┌───────────────────┐  │ │
│  │    │  Auth    │ │  Rate    │ │  CORS /   │ │  Request Logger / │  │ │
│  │    │  (JWT)   │ │  Limiter │ │  Helmet   │ │  Morgan           │  │ │
│  │    └──────────┘ └──────────┘ └───────────┘ └───────────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└──────────┬───────────┬────────────┬──────────────┬──────────────────────┘
           │           │            │              │
┌──────────┼───────────┼────────────┼──────────────┼──────────────────────┐
│          │     AI SERVICES LAYER  │              │                       │
│  ┌───────▼──────┐ ┌──▼─────────┐ ┌▼───────────┐ ┌▼──────────────────┐  │
│  │  EI Engine   │ │   Bias     │ │  Journal   │ │  MCP Memory       │  │
│  │  (PyTorch)   │ │  Detection │ │  Research  │ │  Server           │  │
│  │              │ │ (Fairlearn)│ │  Pipeline  │ │  (FastAPI)        │  │
│  └──────┬───────┘ └──────┬─────┘ └──────┬─────┘ └────────┬──────────┘  │
│         │                │              │                 │             │
└─────────┼────────────────┼──────────────┼─────────────────┼─────────────┘
          │                │              │                 │
┌─────────┼────────────────┼──────────────┼─────────────────┼─────────────┐
│         │          DATA LAYER           │                 │             │
│  ┌──────▼──────┐ ┌──────▼─────┐  ┌─────▼──────┐  ┌──────▼──────────┐  │
│  │  MongoDB    │ │  Redis     │  │  AWS S3 /  │  │  Mem0 Vector   │  │
│  │  (Primary)  │ │  (Cache /  │  │  R2 (Blob) │  │  Store (Qdrant) │  │
│  │             │ │  Sessions) │  │            │  │                 │  │
│  └─────────────┘ └────────────┘  └────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
```

## Core components

The platform is composed of eight primary services, each with a distinct responsibility domain.

<CardGroup cols={2}>
  <Card title="Frontend Application" icon="window">
    **Astro 5 + React 19 + TypeScript**

    Server-side rendered application delivering the trainee interface, supervisor dashboard, and administrative panels. Astro's island architecture ensures minimal JavaScript is shipped to the client while React handles interactive components.
  </Card>
  <Card title="API Gateway" icon="shield-halved">
    **Node.js + Express**

    Central entry point for all client requests. Handles authentication (JWT validation), rate limiting, CORS enforcement, request logging, and route delegation to downstream services.
  </Card>
  <Card title="EI Engine" icon="brain">
    **Python + PyTorch**

    The Emotional Intelligence Engine — the analytical heart of the platform. Maps conversations using Plutchik's Wheel of Emotions across eight primary dimensions, tracking valence, arousal, and dominance in real time.
  </Card>
  <Card title="Bias Detection" icon="scale-balanced">
    **Python + Fairlearn + NumPy**

    Continuous analysis of therapeutic sessions for demographic bias across gender, age, ethnicity, and language. Produces fairness metrics (demographic parity, equalized odds, treatment equality) and generates actionable recommendations.
  </Card>
  <Card title="Journal Research Pipeline" icon="book-open-reader">
    **Python + FastAPI + HuggingFace**

    Automated pipeline for sourcing, processing, and integrating academic research from PubMed, arXiv, and IEEE Xplore. Powers evidence-based feedback and keeps therapeutic guidance current with published literature.
  </Card>
  <Card title="Training Platform" icon="dumbbell">
    **React + Three.js + WebSocket**

    The Empathy Gym™ simulation engine. Renders immersive training scenarios with 3D visualization, real-time WebSocket communication for live session feedback, and dynamic difficulty adjustment based on trainee performance.
  </Card>
  <Card title="MCP Memory Server" icon="database">
    **Python + FastAPI**

    Central memory authority implementing the Model Context Protocol (MCP). Manages long-term memory via Mem0 + Google Gemini integration with PII filtering, crisis detection, and HIPAA-compliant storage.
  </Card>
  <Card title="Data Layer" icon="layer-group">
    **MongoDB + Redis + S3 + Qdrant**

    Multi-store data architecture. MongoDB for persistent document storage, Redis for session caching and real-time state, S3/R2 for blob storage, and Qdrant for vector-based memory search.
  </Card>
</CardGroup>

## Component deep dives

### Frontend Application

The frontend uses Astro 5's hybrid rendering model — static pages are pre-rendered at build time while dynamic routes use server-side rendering (SSR) for personalized content.

<Tabs>
  <Tab title="Technology Stack">
    | Technology | Purpose |
    |---|---|
    | Astro 5 | Framework — SSR + static generation, island architecture |
    | React 19 | Interactive components — training UI, dashboards, forms |
    | TypeScript | Type safety across the entire frontend codebase |
    | UnoCSS | Utility-first CSS engine for styling |
    | Three.js | 3D visualization for training scenario environments |
    | WebSocket | Real-time bidirectional communication during training sessions |
  </Tab>
  <Tab title="Key Responsibilities">
    - Render the trainee-facing Empathy Gym™ interface
    - Display real-time emotional analytics and session feedback
    - Provide supervisor dashboards with trainee progress tracking
    - Handle client-side audio processing (zero-knowledge architecture)
    - Manage WebSocket connections for live training sessions
    - Integrate with MCP Memory Client for memory dashboard operations
  </Tab>
  <Tab title="Island Architecture">
    Astro's island architecture is critical to performance. Static content (documentation, marketing, onboarding) ships zero JavaScript. Interactive "islands" — the training simulator, analytics charts, memory dashboard — hydrate independently.

    ```typescript
    // Astro page with React islands
    ---
    import TrainingSimulator from '../components/TrainingSimulator'
    import EmotionChart from '../components/EmotionChart'
    ---

    <Layout title="Empathy Gym">
      <!-- Static content: zero JS -->
      <h1>Training Session</h1>
      <p>Welcome to your practice environment.</p>

      <!-- Interactive islands: hydrate on load -->
      <TrainingSimulator client:load />
      <EmotionChart client:visible />
    </Layout>
    ```
  </Tab>
</Tabs>

### API Gateway

The Express-based API gateway serves as the single entry point for all client traffic, enforcing security policies before requests reach downstream services.

```typescript
// Security middleware chain
app.use(helmet())                    // Security headers
app.use(cors({ credentials: true })) // CORS with credentials
app.use(express.json({ limit: '10mb' }))
app.use(compression())               // Response compression
app.use(morgan(morganFormat))         // Request logging
app.use(requestLogger)                // Custom audit trail
app.use(rateLimiter)                  // Rate limiting

// Public routes (no auth)
app.use('/api/health', healthRoutes)
app.use('/api/auth', authRoutes)

// Protected routes (auth required)
app.use(authMiddleware)
app.use('/api/documents', documentRoutes)
app.use('/api/projects', projectRoutes)
app.use('/api/users', userRoutes)
```

<Info>
  The gateway connects to **three database systems** at startup: MongoDB (persistent storage), PostgreSQL (relational data), and Redis (caching and sessions). Graceful shutdown ensures all connections are properly closed on `SIGTERM`.
</Info>

### EI Engine (Emotional Intelligence)

The EI Engine processes every utterance in a training session through a multi-dimensional emotional analysis pipeline.

<AccordionGroup>
  <Accordion title="Emotional Mapping" icon="map">
    Conversations are mapped using **Plutchik's Wheel of Emotions** across eight primary dimensions: Joy, Trust, Fear, Surprise, Sadness, Disgust, Anger, and Anticipation. Each emotion is scored on a `0.0`–`1.0` normalized scale with intensity, valence, and arousal dimensions.

    The mapper also detects **complex emotional dyads** — compound emotions formed by combining primary emotions (e.g., Joy + Trust = Love, Fear + Surprise = Awe).
  </Accordion>
  <Accordion title="Dimensional Analysis" icon="chart-scatter">
    Beyond discrete emotions, every utterance is placed in a three-dimensional space:
    - **Valence**: Pleasant ↔ Unpleasant (−1.0 to +1.0)
    - **Arousal**: Calm ↔ Excited (0.0 to 1.0)
    - **Dominance**: Submissive ↔ Dominant (0.0 to 1.0)

    This enables detection of subtle emotional shifts that categorical models miss — like the difference between quiet sadness (low arousal, low dominance) and frustrated anger (high arousal, high dominance).
  </Accordion>
  <Accordion title="Transition Detection" icon="arrows-spin">
    The engine tracks **emotional trajectories** over the course of a conversation, identifying significant transitions (e.g., moving from defensive anger to vulnerable sadness) and flagging them as potential breakthrough moments for the trainee.
  </Accordion>
</AccordionGroup>

### Bias Detection Service

The bias detection service runs as a sidecar analysis on every therapeutic session, producing fairness metrics and actionable recommendations.

```python
# Bias analysis produces multi-dimensional fairness metrics
result = analyze_session_bias(session)

# Result includes:
# - overall_bias_score: 0.0-1.0 aggregate score
# - bias_level: NONE | LOW | MODERATE | HIGH | CRITICAL
# - indicators: per-category breakdowns (gender, age, ethnicity)
# - recommendations: actionable improvement suggestions
# - fairness_metrics: {
#     demographic_parity: 0.92,
#     equalized_odds: 0.88,
#     treatment_equality: 0.95
#   }
```

<Warning>
  Sessions with **HIGH** or **CRITICAL** bias levels automatically trigger supervisor notifications and are flagged for mandatory review. The bias detection model is continuously updated with diverse training data to reduce false positives.
</Warning>

### MCP Memory Server

The Memory Server implements the **Model Context Protocol (MCP)** — an open standard for AI agent memory management. It serves as the central memory authority for the entire platform.

| Endpoint | Method | Purpose |
|---|---|---|
| `/api/memory/add` | POST | Store a new memory with PII filtering |
| `/api/memory/search` | POST | Semantic search across user memories |
| `/api/memory/all/{user_id}` | GET | Retrieve all memories for a user |
| `/api/memory/{memory_id}` | PATCH | Update an existing memory |
| `/api/memory/{memory_id}` | DELETE | Delete a specific memory |

<Tip>
  The MCP Server runs on port `5003` by default and is accessible to both the backend inference service and the frontend memory dashboard via the `MCPMemoryClient`.
</Tip>

## Inter-service communication

Services communicate through a combination of synchronous HTTP/REST calls and asynchronous WebSocket connections, depending on latency requirements.

<Tabs>
  <Tab title="Synchronous (HTTP/REST)">
    Used for request-response patterns where the client waits for a result:
    - **Frontend → API Gateway**: All user-initiated actions (login, start session, fetch analytics)
    - **API Gateway → AI Services**: Inference requests, bias analysis, session scoring
    - **API Gateway → MCP Server**: Memory CRUD operations
    - **AI Services → Data Layer**: Database reads/writes, cache operations
  </Tab>
  <Tab title="Asynchronous (WebSocket)">
    Used for real-time, bidirectional communication during live training:
    - **Frontend ↔ Training Platform**: Live session state, emotional feedback, persona responses
    - **Training Platform → EI Engine**: Streaming emotional analysis of trainee utterances
    - **Crisis Detection → Supervisor Dashboard**: Immediate crisis alert notifications
  </Tab>
  <Tab title="Internal (Service-to-Service)">
    Direct internal calls between co-located services:
    - **MCP Server → GeminiMem0Manager**: Memory storage with PII filtering
    - **Pixel Inference Service → GeminiMem0Manager**: Context retrieval for response generation
    - **Bias Detection → EI Engine**: Emotional context for bias severity assessment
  </Tab>
</Tabs>

## Technology matrix

| Layer | Technology | Version | Purpose |
|---|---|---|---|
| **Frontend** | Astro | 5.x | SSR framework, island architecture |
| **Frontend** | React | 19.x | Interactive UI components |
| **Frontend** | TypeScript | 5.x | Type safety |
| **API** | Node.js | 24.x | Runtime environment |
| **API** | Express | 4.x | HTTP framework, middleware chain |
| **AI/ML** | Python | 3.12+ | AI service runtime |
| **AI/ML** | PyTorch | 2.x | Deep learning, emotion models |
| **AI/ML** | FastAPI | 0.100+ | High-performance API framework |
| **AI/ML** | Fairlearn | Latest | Fairness metrics and bias detection |
| **AI/ML** | HuggingFace | Latest | NLP models, research pipeline |
| **Memory** | Mem0 | Latest | Long-term vector memory |
| **Memory** | Google Gemini | 2.0 Flash | PII filtering, response generation |
| **Data** | MongoDB | 7.x | Primary document store |
| **Data** | PostgreSQL | 15.x | Relational data (CMS, analytics) |
| **Data** | Redis | 7.x | Session cache, real-time state |
| **Data** | Qdrant | Latest | Vector store for memory search |
| **Storage** | AWS S3 / Cloudflare R2 | — | Blob storage (documents, exports) |
| **Infra** | Docker | Latest | Containerization |
| **Infra** | Kubernetes | 1.28+ | Orchestration (production) |
| **Infra** | Helm | 3.x | Kubernetes package management |
| **Infra** | Terraform | 1.9+ | Infrastructure as code |

## Design principles

<CardGroup cols={2}>
  <Card title="Privacy by Design" icon="lock">
    PII is filtered at the memory layer before storage. Audio is processed client-side (zero-knowledge). All data transit is encrypted. HIPAA compliance is architectural, not bolted on.
  </Card>
  <Card title="Graceful Degradation" icon="life-ring">
    Every external dependency has a fallback. Memory system: Gemini → Mem0 → NullMemory. AI inference: Primary model → Fallback model → Cached response. Database: Primary → Read replica → Cache.
  </Card>
  <Card title="Observable by Default" icon="chart-line">
    Every service emits structured logs, health checks, and Prometheus metrics. Grafana dashboards provide real-time visibility. Sentry captures errors with full context.
  </Card>
  <Card title="Independently Deployable" icon="cubes">
    Each service has its own Dockerfile, health endpoint, and deployment configuration. Services can be updated, scaled, or rolled back independently without affecting the rest of the platform.
  </Card>
</CardGroup>

---

<Info>
  **Next:** Learn how data flows through the system in [Data Flow & Integration Points](/architecture/data-flow), or explore the [Memory System Architecture](/architecture/memory-system) for details on long-term memory and PII filtering.
</Info>
